{% extends 'webapp/base.html' %}

{% block content %}

    <h5> Welcome, {{user}}! ðŸ‘‹ </h5>

    <hr>

    <h5> Here will appear your statistics! </h5>

    <hr> 

    <!-- Statistics -->
<h3>Task Statistics by Project</h3>
<ul>
    {% for stat in task_stats_by_project %}
    <li>
        {{ stat.project__name }}: {{ stat.total_tasks }} tasks, Total Duration: {{ stat.total_duration }} hours
    </li>
    {% endfor %}
</ul>
<!-- Filters -->
<form method="get">
    <label for="project">Filter by Project:</label>
    <select name="project" id="project">
        <option value="">All Projects</option>
        {% for project in projects %}
        <option value="{{ project.id }}" {% if selected_project|stringformat:"s" == project.id|stringformat:"s" %}selected{% endif %}>{{ project.name }}</option>
        {% endfor %}
    </select>

    <label for="organizer">Filter by User:</label>
    <select name="organizer" id="organizer">
        <option value="">All Users</option>
        {% for organizer in organizers %}
        <option value="{{ organizer.id }}" {% if selected_organizer == organizer.id|stringformat:"s" %}selected{% endif %}>{{ organizer.username }}</option>
        {% endfor %}
    </select>
    <!-- Date Range Filters -->
    <br>
    <label for="start_date">Start Date:</label>
    <input type="date" id="start_date" name="start_date" value="{{ request.GET.start_date }}">

    <label for="end_date">End Date:</label>
    <input type="date" id="end_date" name="end_date" value="{{ request.GET.end_date }}">

    <button type="submit">Filter</button>
</form>
<br>Filtered Tasks:
<table class="table table-hover table-bordered">

    <thead class="table-light">

        <tr>

            <th scope="col"> ID </th>
            <th scope="col"> Title </th>
            <th scope="col"> Description </th>
            <th scope="col"> Date </th>
            <th scope="col"> Start Time </th>
            <th scope="col"> Project </th>
            <th scope="col"> Duration(h) </th>
            <th scope="col"> User </th>

            <th scope="col"> View </th>

        </tr>

    </thead>

    <tbody>

    {% if tasks %}

        {% for task in tasks %}

        <tr>

            <td> {{task.id}} </td>

            <td> {{task.title}} </td>

            <td> {{task.description}} </td>

            <td> {{task.date}} </td>
            <td> {{task.time}} </td>
            <td> {{task.project}} </td>
            <td> {{task.duration}} </td>
            <td> {{ task.organizer }} </td>

            <td> <a class="btn btn-success btn-sm" href="{% url 'task_detail' task.id %}"> <i class="fa fa-eye" aria-hidden="true"></i> </a> </td>

        </tr>

        {% endfor %}
    
    {% endif %}
    
</table>
<!-- Display total duration of all filtered tasks -->
<h4>Total Duration of Filtered Tasks</h4>
<p>{{ total_duration }} hours</p>

<form method="get" action="{% url 'export_tasks_csv' %}">
    <input type="hidden" name="project" value="{{ selected_project }}">
    <input type="hidden" name="organizer" value="{{ selected_organizer }}">
    <input type="hidden" name="start_date" value="{{ start_date }}">
    <input type="hidden" name="end_date" value="{{ end_date }}">
    <button type="submit">Export to CSV</button>
</form>
</tbody>
{% endblock %}
